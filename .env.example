# ============================================
# ScoutBot v0.4 - Configuration Template
# ============================================
# Copy this file to .env and fill in your values
# cp .env.example .env

# ============================================
# Bot Configuration (REQUIRED)
# ============================================
# Get your bot token from @BotFather on Telegram
BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz-123456789

# ============================================
# Server Configuration
# ============================================
PORT=8916
HOST=0.0.0.0

# ============================================
# Database Configuration
# ============================================
# For production: sqlite:///app/data/production.db
# For development: sqlite:///./data/development.db
DATABASE_URL=sqlite:///app/data/production.db

# ============================================
# Redis Configuration
# ============================================
# Redis is used for caching and rate limiting
# Set DISABLE_REDIS=true if you don't have Redis
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
DISABLE_REDIS=false

# ============================================
# Application Configuration
# ============================================
# Environment: production or development
ENVIRONMENT=production

# Log Level: Controls verbosity of logs
# - debug: Show all logs (verbose, for troubleshooting)
# - info: Show info, warning, and error logs (recommended for production)
# - warning: Show only warnings and errors
# - error: Show only errors
LOG_LEVEL=info

# ============================================
# Timezone Configuration
# ============================================
# Set timezone for logs and application
# Examples:
#   America/Sao_Paulo (Brazil - São Paulo, UTC-3)
#   America/New_York (US Eastern, UTC-5/-4)
#   Europe/London (UK, UTC+0/+1)
#   Asia/Tokyo (Japan, UTC+9)
# List: https://en.wikipedia.org/wiki/List_of_tz_database_time_zones
TZ=America/Sao_Paulo

# ============================================
# Access Control (optional)
# ============================================
# Restrict bot to respond only to your user ID
# To find your ID: Start a chat with @userinfobot on Telegram
# Leave empty to allow all users
ALLOWED_USER_ID=

# ============================================
# Reddit API Configuration
# ============================================
# Method 1: RSS Only (recommended - no 403 errors)
# Uses https://www.reddit.com/r/subreddit/.rss
USE_REDDIT_API=false
USE_REDDIT_JSON_FALLBACK=false

# Method 2: OAuth API (requires Reddit app credentials)
# Get credentials from: https://www.reddit.com/prefs/apps
# 1. Create a "script" app (not "web app" or "installed app")
# 2. Copy Client ID (under the app name)
# 3. Copy Secret (click "edit" → "secret")
# 4. Use your Reddit username and password (or app password if using 2FA)
REDDIT_CLIENT_ID=abc123def456ghi789jkl
REDDIT_CLIENT_SECRET=xyz789uvw456rst123opq
REDDIT_USERNAME=your_username_here
REDDIT_PASSWORD=your_password_here

# ============================================
# Feature Flags
# ============================================
FEATURE_INSTAGRAM=false

# ============================================
# Resilience System Configuration (optional)
# ============================================
# Enable/disable the resilience system for Telegram API
TELEGRAM_RESILIENCE_ENABLED=true

# Retry configuration
TELEGRAM_MAX_RETRIES=10
TELEGRAM_BASE_DELAY=1000
TELEGRAM_MAX_DELAY=60000

# Circuit breaker configuration
TELEGRAM_CIRCUIT_BREAKER_THRESHOLD=5
TELEGRAM_CIRCUIT_BREAKER_TIMEOUT=300000

# Message queue configuration
MESSAGE_QUEUE_ENABLED=true
MESSAGE_QUEUE_MAX_SIZE=1000
MESSAGE_QUEUE_BATCH_SIZE=20
MESSAGE_QUEUE_PROCESSING_INTERVAL=5000
MESSAGE_QUEUE_MESSAGE_TTL=3600000

# Health monitoring configuration
HEALTH_CHECK_INTERVAL=30000
ALERT_THRESHOLD_ERROR_RATE=0.1
ALERT_THRESHOLD_DOWNTIME_MINUTES=15
ALERT_THRESHOLD_QUEUE_SIZE=500

# Job cleanup configuration
JOB_CLEANUP_ENABLED=true
JOB_CLEANUP_INTERVAL_MINUTES=30
JOB_CLEANUP_THOROUGH_INTERVAL_HOURS=2
JOB_CLEANUP_ORPHANED_THRESHOLD=10

# ============================================
# Advanced Settings (optional)
# ============================================
# MAX_FEEDS_PER_CHAT=50
# CACHE_TTL_MINUTES=20
# CIRCUIT_BREAKER_THRESHOLD=3
# MIN_DELAY_MS=200000

# ============================================
# Anti-Blocking System Configuration
# ============================================
# Enable/disable anti-blocking features
ANTI_BLOCK_ENABLED=true

# Minimum delay between requests to same domain (seconds)
ANTI_BLOCK_MIN_DELAY=5.0

# Maximum delay between requests to same domain (seconds)
ANTI_BLOCK_MAX_DELAY=300.0

# Number of consecutive failures before circuit breaker activates
ANTI_BLOCK_CIRCUIT_BREAKER_THRESHOLD=5

# ============================================
# Video Download Configuration
# ============================================
# Enable FFmpeg for video/audio processing (thumbnails, format conversion)
# Note: FFmpeg is installed in Docker but this flag controls usage
# REQUIRED for MP3 conversion: Set to true to use /download mp3 <url>
ENABLE_FFMPEG=true

# Enable Aria2 for multi-threaded direct downloads (faster downloads)
ENABLE_ARIA2=false

# Audio format for audio-only downloads (mp3, m4a, wav, etc.)
# Used when format is set to "audio" via /settings or /download mp3
# For MP3 conversion: Use /download mp3 <url> (automatically sets this to mp3)
AUDIO_FORMAT=mp3

# Enable m3u8 (HLS) stream support
M3U8_SUPPORT=false

# Browser for cookies (firefox, chrome, edge, etc.) - used for anti-blocking
# Leave empty to use default
BROWSERS=

# Maximum file size for Telegram uploads in MB (default: 2000MB)
TG_NORMAL_MAX_SIZE=2000

# Maximum URL length in captions (default: 150 characters)
CAPTION_URL_LENGTH_LIMIT=150

# Path for temporary/download files (optional, defaults to system temp)
# Example: /tmp/scoutbot or ./tmp
TMPFILE_PATH=

# ============================================
# Media Toolbox Configuration
# ============================================
# Enable /clip command (extract video segments)
ENABLE_CLIP=true

# Enable /gif command (generate GIFs from videos)
ENABLE_GIF=true

# Maximum GIF size in MB (default: 10MB, Telegram limit)
MAX_GIF_SIZE=10

# Maximum GIF duration in seconds (default: 15 seconds)
GIF_DURATION_LIMIT=15

# ============================================
# Job System Configuration
# ============================================
# Job queue backend (apscheduler or celery)
JOB_QUEUE_BACKEND=apscheduler

# Enable job persistence across restarts (uses SQLiteJobStore)
JOB_PERSISTENCE_ENABLED=true

# Enable job status tracking in database
JOB_STATUS_TRACKING=true

# ============================================
# ImageMagick Configuration
# ============================================
# Enable ImageMagick for image processing (ImageMagick is installed in Docker container)
ENABLE_IMAGEMAGICK=true

# Enable sticker factory commands
ENABLE_STICKERS=true

# Enable meme generator commands
ENABLE_MEMES=true

# ============================================
# OCR Configuration
# ============================================
# Enable OCR functionality
ENABLE_OCR=false

# Tesseract language codes (e.g., por+eng for Portuguese and English)
TESSERACT_LANG=por+eng

# ============================================
# Webhook Configuration
# ============================================
# Enable webhook mode instead of polling (requires HTTPS and public URL)
USE_WEBHOOK=false

# Public HTTPS URL for webhook (required if USE_WEBHOOK=true)
# Example: https://yourdomain.com/webhook/YOUR_BOT_TOKEN
WEBHOOK_URL=

# Secret token for webhook verification (optional, recommended for security)
WEBHOOK_SECRET=

# Port for webhook endpoint (default: 8916)
WEBHOOK_PORT=8916

# ============================================
# YouTube Anti-blocking Configuration
# ============================================
# Minimum sleep interval between downloads in seconds (default: 3)
# Helps avoid rate limiting by adding delays between requests
YOUTUBE_SLEEP_INTERVAL=3

# Maximum sleep interval between downloads in seconds (default: 8)
# Random delay between YOUTUBE_SLEEP_INTERVAL and this value
YOUTUBE_MAX_SLEEP_INTERVAL=8

# Limit download rate to avoid detection (default: 2M = 2MB/s)
# Examples: 2M, 1.5M, 500K
YOUTUBE_LIMIT_RATE=2M

# Number of concurrent fragments (default: 4, lower = less aggressive)
# Reduces from default 16 to avoid triggering anti-bot measures
YOUTUBE_CONCURRENT_FRAGMENTS=4

# Comma-separated list of YouTube player clients to rotate
# Available: web, ios, android, android_sdkless, web_safari, tv, tv_downgraded
# Rotating clients helps avoid detection
YOUTUBE_PLAYER_CLIENTS=web,ios,android

# Enable player client rotation (default: true)
# When enabled, randomly selects from YOUTUBE_PLAYER_CLIENTS
YOUTUBE_ROTATE_CLIENTS=true

# Custom user agent string (optional, leave empty to use yt-dlp default)
# Example: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
YOUTUBE_USER_AGENT=

# ============================================
# YouTube Authentication Configuration (yt-dlp unified)
# ============================================
# Authentication mode: browser, cookiefile, both, none
# - cookiefile: Use cookies from file (RECOMMENDED for VPS/production)
# - browser: Use cookies from browser (for local development)
# - both: Try browser first, fallback to file
# - none: No authentication (only works on residential IPs)
# 
# IMPORTANT: VPS/datacenter IPs are blocked by YouTube
# Solution: Use cookiefile mode with exported cookies from your browser
# See VPS_SETUP.md for detailed instructions
YTDLP_AUTH_MODE=cookiefile

# Path to YouTube cookies file (used when YTDLP_AUTH_MODE is cookiefile or both)
# Default: /secrets/youtube-cookies.txt (in Docker) or youtube-cookies.txt (local)
# Export cookies using "Get cookies.txt LOCALLY" browser extension
# Transfer to VPS: scp youtube-cookies.txt user@vps:/path/to/scoutbot/secrets/
YTDLP_COOKIES_FILE=/secrets/youtube-cookies.txt

# Browser for cookies-from-browser (firefox, chrome, chromium, edge, brave)
# Only used when YTDLP_AUTH_MODE is browser or both
# Leave empty when using cookiefile mode
YTDLP_COOKIES_FROM_BROWSER=

# Browser profile name (default: "default")
# Only used when YTDLP_AUTH_MODE is browser or both
YTDLP_BROWSER_PROFILE=default

# Firefox container (default: "none", only for Firefox)
# Only used when YTDLP_AUTH_MODE is browser or both
YTDLP_FIREFOX_CONTAINER=none

# Manual PO Token (fallback, rarely needed)
# PO Token Provider (yt-dlp-getpot-wpc) works automatically when installed
# Only set this if automatic provider fails and cookies don't work
YTDLP_PO_TOKEN=

# Enable automatic PO Token Provider (default: false)
# WARNING: Enabling this will spawn a Chromium instance for each download
# Only enable if cookies are not working and you're getting 403 errors
# When disabled (default), the system uses cookies only (more efficient)
# RECOMMENDED: Keep disabled and use cookies instead
YTDLP_ENABLE_PO_PROVIDER=false

# Path to Chromium binary for PO Token Provider (default: /usr/bin/chromium)
# Used by yt-dlp-getpot-wpc for automatic PO Token generation
# Only relevant if YTDLP_ENABLE_PO_PROVIDER=true
YTDLP_CHROMIUM_PATH=/usr/bin/chromium

# YouTube player clients for PO Token (default: "default,mweb")
YTDLP_PLAYER_CLIENTS=default,mweb

# Unified yt-dlp sleep interval (seconds, default: 6)
YTDLP_SLEEP_INTERVAL=6

# Unified yt-dlp max sleep interval (seconds, default: 10)
YTDLP_MAX_SLEEP_INTERVAL=10

# Unified yt-dlp retries (default: 5)
YTDLP_RETRIES=5

# ============================================
# Telegram Bot API Server Configuration
# ============================================
# Local Bot API Server allows uploads up to 2GB (vs 50MB on standard Bot API)
# Get your API credentials from: https://my.telegram.org/apps
# 
# API ID and Hash (required for Local Bot API Server)
# These are example values - replace with your real credentials in .env
TELEGRAM_API_ID=12345678
TELEGRAM_API_HASH=abcdef1234567890abcdef1234567890

# URL of the local Telegram Bot API Server (internal Docker network)
# Default: http://telegram-bot-api:8081
TELEGRAM_BOT_API_SERVER_URL=http://telegram-bot-api:8081

# Path to Bot API data directory (for local mode file access)
# This is automatically set in docker-compose.yml, but can be overridden
# TELEGRAM_BOT_API_DATA_PATH=/var/lib/telegram-bot-api

# Enable/disable use of local Bot API Server
# Set to true to use local server (allows 2GB uploads)
# Set to false to use standard Telegram Bot API (50MB limit)
TELEGRAM_USE_LOCAL_API=true

# ============================================
# Spotify Configuration
# ============================================
# Get your Spotify API credentials from: https://developer.spotify.com/dashboard
# 1. Create a new app in Spotify Developer Dashboard
# 2. Copy Client ID and Client Secret
# 3. Add credentials below
# 
# Client ID from Spotify Developer Dashboard
SPOTIFY_CLIENT_ID=your_client_id

# Client Secret from Spotify Developer Dashboard
SPOTIFY_CLIENT_SECRET=your_client_secret

# Audio format for Spotify downloads (mp3, m4a, opus, flac, ogg, wav)
# Default: mp3
SPOTIFY_AUDIO_FORMAT=mp3

# Bitrate for Spotify downloads (128k, 256k, auto, disable)
# Default: auto (recommended - adapts to available quality)
# Note: Higher bitrates (256k) may not always be available
SPOTIFY_BITRATE=auto

# Comma-separated list of audio providers to use (in order of preference)
# Available: youtube-music, youtube, soundcloud, bandcamp, piped
# Default: youtube,youtube-music (recommended - works without authentication)
SPOTIFY_AUDIO_PROVIDERS=youtube,youtube-music

# Comma-separated list of lyrics providers to use (in order of preference)
# Available: genius, musixmatch, azlyrics, synced
# Default: genius,musixmatch,azlyrics
SPOTIFY_LYRICS_PROVIDERS=genius,musixmatch,azlyrics

# Enable/disable Spotify download functionality
# Set to true to enable Spotify downloads via /download command
# Set to false to disable (default: true)
SPOTIFY_ENABLED=true

# ============================================
# Pentaract Storage Configuration
# ============================================
# Pentaract is a storage system that splits files into chunks and stores them in Telegram
# This allows unlimited storage without using local disk space
# 
# Enable/disable Pentaract storage integration
# Set to true to enable automatic uploads to Pentaract for large files
# Set to false to use only local Telegram storage (default: false)
PENTARACT_ENABLED=false

# Pentaract API base URL
# Default: http://localhost:8547/api
# For Docker: http://pentaract:8547/api
PENTARACT_API_URL=http://localhost:8547/api

# Pentaract account credentials (REQUIRED when PENTARACT_ENABLED=true)
# Email and password for your Pentaract account
PENTARACT_EMAIL=your_email@example.com
PENTARACT_PASSWORD=your_password

# Minimum file size (in MB) for automatic Pentaract upload
# Files larger than this threshold will be automatically uploaded to Pentaract
# Default: 50 (MB)
PENTARACT_UPLOAD_THRESHOLD=50

# Automatically cleanup temporary files after upload
# Set to true to delete temp files immediately after successful upload
# Set to false to keep temp files (not recommended)
# Default: true
PENTARACT_AUTO_CLEANUP=true

# Cleanup interval in minutes
# How often to run periodic cleanup of old temporary files
# Default: 30 (minutes)
PENTARACT_CLEANUP_INTERVAL=30

# Maximum concurrent uploads to Pentaract
# Limits the number of simultaneous uploads to avoid overloading the system
# Default: 3
PENTARACT_MAX_CONCURRENT_UPLOADS=3

# API request timeout in seconds
# How long to wait for Pentaract API responses before timing out
# Default: 30 (seconds)
PENTARACT_TIMEOUT=30

# Number of retry attempts for failed uploads
# How many times to retry a failed upload before giving up
# Default: 3
PENTARACT_RETRY_ATTEMPTS=3
